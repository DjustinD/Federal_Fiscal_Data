<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deferred Taxation: USA vs Canada Fiscal Policy Analysis</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; padding: 20px; background: #f8f9fa; line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 30px; font-style: italic; }
        .charts-container { 
            display: flex; flex-direction: column; gap: 30px; margin: 30px 0; 
        }
        .chart { 
            width: 100%; 
            background: white; border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px;
        }
        .chart h2 { 
            text-align: center; margin-bottom: 20px; 
            font-size: 1.4em; color: #34495e;
        }
        .table-container { 
            background: white; border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            overflow: auto; margin: 20px 0;
        }
        table { 
            width: 100%; border-collapse: collapse; 
            font-size: 0.9em;
        }
        th, td { 
            padding: 10px; text-align: right; 
            border-bottom: 1px solid #ecf0f1;
        }
        th { 
            background: #34495e; color: white; 
            position: sticky; top: 0; z-index: 10;
        }
        th:first-child, td:first-child { text-align: left; }
        tr:nth-child(even) { background: #f8f9fa; }
        tr:hover { background: #e8f4f8; }
        .usa-data { color: #e74c3c; font-weight: 600; }
        .canada-data { color: #3498db; font-weight: 600; }
        .calculated { background: #ecf0f1; font-style: italic; }
        .legend { 
            display: flex; justify-content: center; 
            gap: 30px; margin: 20px 0; flex-wrap: wrap;
        }
        .legend-item { 
            display: flex; align-items: center; gap: 8px; 
            font-size: 0.9em;
        }
        .legend-color { 
            width: 16px; height: 3px; border-radius: 2px;
        }
        .axis { font-size: 12px; }
        .axis-label { font-size: 14px; font-weight: 600; }
        .grid-line { stroke: #e0e0e0; stroke-dasharray: 2,2; }
        .chart-line { fill: none; stroke-width: 2.5; }
        .chart-area { fill-opacity: 0.1; }
        .tooltip { 
            position: absolute; background: rgba(0,0,0,0.8); 
            color: white; padding: 8px; border-radius: 4px; 
            font-size: 12px; pointer-events: none; z-index: 1000;
        }
        .sources { 
            background: white; border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            padding: 20px; margin: 20px 0; font-size: 0.85em;
        }
        .sources h3 { color: #2c3e50; margin-bottom: 15px; }
        .sources ul { margin: 0; padding-left: 20px; }
        .sources li { margin-bottom: 8px; }
        
        /* New styling for analysis sections */
        .analysis-section, .key-findings, .deferred-taxation, .chart-insights, 
        .fiscal-philosophy, .economic-implications, .sustainability, .conclusion {
            background: white; border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            padding: 20px; margin: 20px 0; 
        }
        
        .findings-grid, .insights-grid, .implications-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin: 20px 0;
        }
        
        .finding-card, .insight-card, .implication-card {
            background: #f8f9fa; border-radius: 6px; padding: 15px;
            border-left: 4px solid #3498db;
        }
        
        .usa-card { border-left-color: #e74c3c; }
        .canada-card { border-left-color: #3498db; }
        
        .philosophy-comparison {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin: 20px 0;
        }
        
        .philosophy-card {
            background: #f8f9fa; border-radius: 6px; padding: 20px;
        }
        
        .usa-philosophy { border-left: 4px solid #e74c3c; }
        .canada-philosophy { border-left: 4px solid #3498db; }
        
        .sustainability-analysis {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin: 20px 0;
        }
        
        .trajectory-concerns, .approach-benefits {
            background: #f8f9fa; border-radius: 6px; padding: 20px;
        }
        
        .trajectory-concerns { border-left: 4px solid #e74c3c; }
        .approach-benefits { border-left: 4px solid #27ae60; }
        
        .key-insight {
            background: #fff3cd; border: 1px solid #ffeaa7; 
            border-radius: 6px; padding: 20px; margin: 20px 0;
            font-size: 1.1em; text-align: center;
        }
        
        .key-insight p { margin: 0; font-weight: 600; color: #856404; }
        
        @media (max-width: 800px) {
            .findings-grid, .insights-grid, .implications-grid, 
            .philosophy-comparison, .sustainability-analysis {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 1200px) {
            .chart { min-width: 400px; }
        }
        @media (max-width: 800px) {
            .charts-container { flex-direction: column; }
            .chart { min-width: 300px; }
            .legend { flex-direction: column; align-items: center; }
            table { font-size: 0.8em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Deferred Taxation: USA vs Canada Fiscal Policy Analysis</h1>
        <p class="subtitle">Understanding how "low taxes" in the USA are actually deferred taxes paid by future generations</p>
        
        <div class="analysis-section">
            <h2>üìä Executive Summary</h2>
            <p>This analysis of government financial data from 2006-2024 reveals a stark contrast in fiscal philosophy between the United States and Canada. The data strongly supports the thesis that <strong>American "low taxes" are actually deferred taxes‚Äîdebt that future generations must repay</strong>‚Äîwhile Canada maintains a more sustainable approach to fiscal management through better alignment of revenues and expenditures.</p>
        </div>

        <div class="key-findings">
            <h2>üîç Key Findings</h2>
            <div class="findings-grid">
                <div class="finding-card usa-card">
                    <h3>United States - The Deferred Tax Story</h3>
                    <ul>
                        <li><strong>Average annual deficit:</strong> $1,179 billion (2006-2024)</li>
                        <li><strong>Persistent structural imbalance:</strong> Only 4 years with deficits below $500 billion</li>
                        <li><strong>COVID-19 explosion:</strong> Deficits reached $3.1 trillion in 2020 and $2.8 trillion in 2021</li>
                        <li><strong>Post-crisis pattern:</strong> Even in "good" economic years, deficits remained substantial</li>
                        <li><strong>Debt explosion:</strong> From $8.5T (2006) to $35.5T (2024) - a 317% increase</li>
                    </ul>
                </div>
                <div class="finding-card canada-card">
                    <h3>Canada - Fiscal Discipline</h3>
                    <ul>
                        <li><strong>Average annual deficit:</strong> $29 billion CAD (2006-2024)</li>
                        <li><strong>Periods of balance:</strong> Actually achieved small surpluses in 2007, 2011, 2013, and 2015</li>
                        <li><strong>Proportional spending:</strong> Even during COVID-19, maintained better spending discipline relative to GDP</li>
                        <li><strong>Quicker recovery:</strong> Returned to more sustainable deficit levels faster post-pandemic</li>
                        <li><strong>Controlled debt growth:</strong> From $449B to $1.2T CAD - a 173% increase (much more restrained)</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="deferred-taxation">
            <h2>üí∞ The Deferred Taxation Thesis</h2>
            <h3>What "Low Taxes" Really Mean</h3>
            <p>When Americans celebrate relatively lower tax rates compared to other developed nations, they're experiencing an accounting illusion. The data reveals:</p>
            <ol>
                <li><strong>Government spending continues regardless of revenue</strong></li>
                <li><strong>The gap is filled by borrowing</strong></li>
                <li><strong>Future taxpayers must service this debt through higher taxes or reduced services</strong></li>
                <li><strong>Interest payments compound the burden over time</strong></li>
            </ol>
            
            <h3>The Mathematics of Deferred Taxation</h3>
            <p>From 2006-2024, the US accumulated approximately <strong>$21.2 trillion in deficits</strong>. This represents:</p>
            <ul>
                <li><strong>Deferred tax burden</strong> that future generations must pay</li>
                <li><strong>Interest costs</strong> that make the eventual tax burden even higher</li>
                <li><strong>Reduced fiscal flexibility</strong> for future policy makers</li>
                <li><strong>Intergenerational wealth transfer</strong> from future taxpayers (younger generation) to current taxpayers (older generation)</li>
            </ul>
        </div>
        
        <div class="charts-container">
            <div class="chart">
                <h2>Fiscal Revenue, Expenditure, Deficit & Debt: USA vs Canada</h2>
                <div id="financial-chart"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <span>Canada Revenue (solid)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #c0392b; background-image: repeating-linear-gradient(90deg, transparent, transparent 8px, white 8px, white 12px);"></div>
                        <span>Canada Expenditure (dashed)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #a93226; background-image: repeating-linear-gradient(90deg, transparent, transparent 2px, white 2px, white 5px);"></div>
                        <span>Canada Total Debt (dotted)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>USA Revenue (solid)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2980b9; background-image: repeating-linear-gradient(90deg, transparent, transparent 8px, white 8px, white 12px);"></div>
                        <span>USA Expenditure (dashed)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #1f4e79; background-image: repeating-linear-gradient(90deg, transparent, transparent 2px, white 2px, white 5px);"></div>
                        <span>USA Total Debt (dotted)</span>
                    </div>
                </div>
            </div>
            <div class="chart">
                <h2>Fiscal Ratios & Years Behind: USA vs Canada</h2>
                <div id="ratios-chart"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <span>Canada Spending Ratio (solid)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #c0392b; background-image: repeating-linear-gradient(90deg, transparent, transparent 8px, white 8px, white 12px);"></div>
                        <span>Canada Years Behind (dashed)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>USA Spending Ratio (solid)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2980b9; background-image: repeating-linear-gradient(90deg, transparent, transparent 8px, white 8px, white 12px);"></div>
                        <span>USA Years Behind (dashed)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-insights">
            <h2>üìà What the Charts Reveal</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <h3>üî¥ USA "Years Behind" Metric</h3>
                    <p>The most revealing metric shows the USA has gone from <strong>3.5 years behind in tax collection (2006)</strong> to <strong>7.2 years behind (2024)</strong>. This means current Americans are enjoying government services that won't be paid for until 7+ years of future tax collection!</p>
                </div>
                <div class="insight-card">
                    <h3>üîµ Canada's Fiscal Restraint</h3>
                    <p>Canada's "Years Behind" metric remains much more stable, staying between <strong>2.0-2.7 years</strong> throughout the entire period. This shows Canadians generally pay for the government services they receive within a reasonable timeframe.</p>
                </div>
                <div class="insight-card">
                    <h3>üìä Spending Ratios Tell the Story</h3>
                    <p>The USA consistently spends more than it collects (ratio > 1.0), while Canada's spending ratio hovers closer to 1.0 with periods actually below 1.0 (surpluses). This demonstrates fundamentally different approaches to fiscal responsibility.</p>
                </div>
                <div class="insight-card">
                    <h3>‚ö° The Compound Effect</h3>
                    <p>The exponential growth in US debt from $8.5T to $35.5T shows how deferred taxation compounds over time. Each year of deficit spending adds to a growing mountain of debt that future Americans must service with interest.</p>
                </div>
            </div>
        </div>

        <div class="fiscal-philosophy">
            <h2>üèõÔ∏è Comparing Fiscal Philosophies</h2>
            <div class="philosophy-comparison">
                <div class="philosophy-card usa-philosophy">
                    <h3>United States: "Spend Now, Tax Later"</h3>
                    <ul>
                        <li>Maintains high spending levels regardless of revenue</li>
                        <li>Uses deficit financing as a primary fiscal tool</li>
                        <li>Prioritizes current consumption over long-term sustainability</li>
                        <li>Shifts tax burden to future generations</li>
                    </ul>
                </div>
                <div class="philosophy-card canada-philosophy">
                    <h3>Canada: "Pay As You Go"</h3>
                    <ul>
                        <li>Generally aligns spending with revenue capacity</li>
                        <li>Uses deficits primarily for counter-cyclical economic management</li>
                        <li>Returns to balance during economic recoveries</li>
                        <li>Maintains intergenerational fiscal fairness</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="economic-implications">
            <h2>üíº Economic Implications</h2>
            <div class="implications-grid">
                <div class="implication-card">
                    <h3>For the United States:</h3>
                    <ul>
                        <li><strong>Debt service costs</strong> consume an increasing share of the budget</li>
                        <li><strong>Crowding out effect</strong> reduces funds available for productive investments</li>
                        <li><strong>Fiscal constraint</strong> limits ability to respond to future crises</li>
                        <li><strong>Political economy problem</strong> creates incentives for continued deficit spending</li>
                    </ul>
                </div>
                <div class="implication-card">
                    <h3>For Canada:</h3>
                    <ul>
                        <li><strong>Fiscal flexibility</strong> maintained for economic downturns</li>
                        <li><strong>Lower debt service burden</strong> leaves more room for program spending</li>
                        <li><strong>Intergenerational equity</strong> preserves fiscal capacity for future taxpayers</li>
                        <li><strong>Counter-cyclical capacity</strong> allows for effective economic stabilization</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="sustainability">
            <h2>üîÆ The Sustainability Question</h2>
            <div class="sustainability-analysis">
                <div class="trajectory-concerns">
                    <h3>üö® US Trajectory Concerns:</h3>
                    <ul>
                        <li><strong>Exponential debt growth</strong> outpacing economic growth in many years</li>
                        <li><strong>Interest rate sensitivity</strong> makes the fiscal position increasingly vulnerable</li>
                        <li><strong>Political difficulty</strong> of raising taxes or cutting spending</li>
                        <li><strong>Demographic pressures</strong> from aging population will worsen the imbalance</li>
                    </ul>
                </div>
                <div class="approach-benefits">
                    <h3>‚úÖ Canadian Approach Benefits:</h3>
                    <ul>
                        <li><strong>Debt-to-GDP stability</strong> maintains fiscal sustainability</li>
                        <li><strong>Policy credibility</strong> supports lower borrowing costs</li>
                        <li><strong>Economic resilience</strong> through maintained fiscal space</li>
                        <li><strong>Social cohesion</strong> through visible connection between taxes paid and benefits received</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="conclusion">
            <h2>üéØ Conclusion: The True Cost of "Low" Taxes</h2>
            <p>The data decisively demonstrates that American fiscal policy represents <strong>deferred taxation rather than genuinely low taxation</strong>. Current taxpayers enjoy government services and benefits while pushing the bill to future generations through deficit financing.</p>
            
            <p>Canada's approach, while involving higher current tax rates, represents a more honest and sustainable fiscal contract. Canadians pay for the government services they receive, maintaining fiscal capacity for genuine emergencies and preserving intergenerational equity.</p>
            
            <div class="key-insight">
                <p><strong>The American model may seem attractive in the short term, but it fundamentally represents a form of intergenerational taxation without representation‚Äîimposing costs on future voters who have no say in current spending decisions.</strong></p>
            </div>
            
            <p>This analysis suggests that true fiscal responsibility requires aligning current revenues with current spending, making the Canadian approach not just more sustainable, but more ethically defensible from an intergenerational perspective.</p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Year</th>
                        <th class="usa-data">Revenue<br>(Billions USD)</th>
                        <th class="usa-data">Expenditure<br>(Billions USD)</th>
                        <th class="usa-data">Deficit<br>(Billions USD)</th>
                        <th class="usa-data">Total Debt<br>(Billions USD)</th>
                        <th class="usa-data calculated">Spending Ratio<br>(Exp/Rev)</th>
                        <th class="usa-data calculated">Years Behind<br>(Debt/Rev)</th>
                        <th class="canada-data">Revenue<br>(Billions CAD)</th>
                        <th class="canada-data">Expenditure<br>(Billions CAD)</th>
                        <th class="canada-data">Deficit<br>(Billions CAD)</th>
                        <th class="canada-data"> Total Debt<br>(Billions CAD)</th>
                        <th class="canada-data calculated">Spending Ratio<br>(Exp/Rev)</th>
                        <th class="canada-data calculated">Years Behind<br>(Debt/Rev)</th>
                    </tr>
                </thead>
                <tbody id="data-table">
                </tbody>
            </table>
        </div>

        <div class="sources">
            <h3>üìä Data Sources</h3>
            <ul>
                <li><strong>USA Revenue & Expenditure:</strong> U.S. Treasury Monthly Treasury Statement (MTS), Congressional Budget Office (CBO)</li>
                <li><strong>USA Debt:</strong> U.S. Treasury Bureau of the Fiscal Service, Historical Debt Outstanding</li>
                <li><strong>Canada Revenue & Expenditure:</strong> Statistics Canada, Department of Finance Annual Financial Reports</li>
                <li><strong>Canada Debt:</strong> Statistics Canada, Department of Finance, Bank of Canada</li>
                <li><strong>Methodology:</strong> All figures in nominal terms, fiscal years ending Sept 30 (USA) and March 31 (Canada)</li>
            </ul>
        </div>
    </div>

    <script>
        // Data embedded directly in HTML
        const data = [
            {year: 2006, usa_revenue: 2407, usa_expenditure: 2655, usa_deficit: 248, usa_debt: 8507, canada_revenue: 222, canada_expenditure: 223, canada_deficit: 1, canada_debt: 449},
            {year: 2007, usa_revenue: 2568, usa_expenditure: 2729, usa_deficit: 161, usa_debt: 9008, canada_revenue: 236, canada_expenditure: 233, canada_deficit: -3, canada_debt: 458},
            {year: 2008, usa_revenue: 2524, usa_expenditure: 2983, usa_deficit: 459, usa_debt: 10025, canada_revenue: 233, canada_expenditure: 239, canada_deficit: 6, canada_debt: 464},
            {year: 2009, usa_revenue: 2105, usa_expenditure: 3518, usa_deficit: 1413, usa_debt: 11910, canada_revenue: 224, canada_expenditure: 274, canada_deficit: 50, canada_debt: 516},
            {year: 2010, usa_revenue: 2163, usa_expenditure: 3458, usa_deficit: 1294, usa_debt: 13562, canada_revenue: 238, canada_expenditure: 280, canada_deficit: 42, canada_debt: 584},
            {year: 2011, usa_revenue: 2303, usa_expenditure: 3603, usa_deficit: 1300, usa_debt: 15223, canada_revenue: 280, canada_expenditure: 276, canada_deficit: -4, canada_debt: 584},
            {year: 2012, usa_revenue: 2450, usa_expenditure: 3537, usa_deficit: 1087, usa_debt: 16066, canada_revenue: 256, canada_expenditure: 271, canada_deficit: 15, canada_debt: 585},
            {year: 2013, usa_revenue: 2775, usa_expenditure: 3455, usa_deficit: 680, usa_debt: 16719, canada_revenue: 271, canada_expenditure: 263, canada_deficit: -8, canada_debt: 616},
            {year: 2014, usa_revenue: 3021, usa_expenditure: 3506, usa_deficit: 485, usa_debt: 17824, canada_revenue: 278, canada_expenditure: 280, canada_deficit: 2, canada_debt: 608},
            {year: 2015, usa_revenue: 3249, usa_expenditure: 3688, usa_deficit: 438, usa_debt: 18151, canada_revenue: 282, canada_expenditure: 280, canada_deficit: -2, canada_debt: 612},
            {year: 2016, usa_revenue: 3268, usa_expenditure: 3853, usa_deficit: 585, usa_debt: 19573, canada_revenue: 291, canada_expenditure: 317, canada_deficit: 26, canada_debt: 631},
            {year: 2017, usa_revenue: 3316, usa_expenditure: 3982, usa_deficit: 665, usa_debt: 20245, canada_revenue: 317, canada_expenditure: 332, canada_deficit: 15, canada_debt: 670},
            {year: 2018, usa_revenue: 3329, usa_expenditure: 4109, usa_deficit: 779, usa_debt: 21516, canada_revenue: 336, canada_expenditure: 349, canada_deficit: 13, canada_debt: 689},
            {year: 2019, usa_revenue: 3462, usa_expenditure: 4448, usa_deficit: 986, usa_debt: 22719, canada_revenue: 338, canada_expenditure: 362, canada_deficit: 24, canada_debt: 721},
            {year: 2020, usa_revenue: 3421, usa_expenditure: 6553, usa_deficit: 3132, usa_debt: 26945, canada_revenue: 334, canada_expenditure: 655, canada_deficit: 322, canada_debt: 1045},
            {year: 2021, usa_revenue: 4047, usa_expenditure: 6818, usa_deficit: 2771, usa_debt: 28428, canada_revenue: 355, canada_expenditure: 448, canada_deficit: 93, canada_debt: 1104},
            {year: 2022, usa_revenue: 4896, usa_expenditure: 6272, usa_deficit: 1376, usa_debt: 30928, canada_revenue: 413, canada_expenditure: 448, canada_deficit: 35, canada_debt: 1147},
            {year: 2023, usa_revenue: 4439, usa_expenditure: 6134, usa_deficit: 1695, usa_debt: 33168, canada_revenue: 450, canada_expenditure: 485, canada_deficit: 35, canada_debt: 1173},
            {year: 2024, usa_revenue: 4919, usa_expenditure: 6752, usa_deficit: 1833, usa_debt: 35464, canada_revenue: 460, canada_expenditure: 521, canada_deficit: 62, canada_debt: 1224}
        ];

        // Calculate additional metrics
        data.forEach(d => {
            d.usa_spending_ratio = d.usa_expenditure / d.usa_revenue;
            d.usa_years_behind = d.usa_debt / d.usa_revenue;
            d.canada_spending_ratio = d.canada_expenditure / d.canada_revenue;
            d.canada_years_behind = d.canada_debt / d.canada_revenue;
        });

        // Populate table
        function populateTable() {
            const tbody = document.getElementById('data-table');
            data.forEach(d => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${d.year}</strong></td>
                    <td class="usa-data">$${d.usa_revenue.toLocaleString()}</td>
                    <td class="usa-data">$${d.usa_expenditure.toLocaleString()}</td>
                    <td class="usa-data">$${d.usa_deficit.toLocaleString()}</td>
                    <td class="usa-data">$${d.usa_debt.toLocaleString()}</td>
                    <td class="usa-data calculated">${d.usa_spending_ratio.toFixed(2)}x</td>
                    <td class="usa-data calculated">${d.usa_years_behind.toFixed(1)} years</td>
                    <td class="canada-data">$${d.canada_revenue.toLocaleString()}</td>
                    <td class="canada-data">$${d.canada_expenditure.toLocaleString()}</td>
                    <td class="canada-data">$${d.canada_deficit.toLocaleString()}</td>
                    <td class="canada-data">$${d.canada_debt.toLocaleString()}</td>
                    <td class="canada-data calculated">${d.canada_spending_ratio.toFixed(2)}x</td>
                    <td class="canada-data calculated">${d.canada_years_behind.toFixed(1)} years</td>
                `;
            });
        }

        // Create charts
        function createFinancialChart() {
            const container = d3.select('#financial-chart');
            const containerNode = container.node();
            const containerWidth = containerNode.getBoundingClientRect().width;
            
            const margin = {top: 20, right: 140, bottom: 80, left: 140};
            const width = containerWidth - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Clear existing chart
            container.selectAll("*").remove();

            const svg = container.append("svg")
                .attr("width", containerWidth)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const xScale = d3.scaleLinear()
                .domain(d3.extent(data, d => d.year))
                .range([0, width]);

            // Canada scale (left axis)
            const canadaScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => Math.max(d.canada_revenue, d.canada_expenditure, d.canada_debt))])
                .range([height, 0]);

            // USA scale (right axis)
            const usaScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => Math.max(d.usa_revenue, d.usa_expenditure, d.usa_debt))])
                .range([height, 0]);

            // Add grid lines (based on Canada scale)
            g.selectAll(".grid-line")
                .data(canadaScale.ticks(8))
                .enter().append("line")
                .attr("class", "grid-line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", d => canadaScale(d))
                .attr("y2", d => canadaScale(d));

            // Line generators - Canada
            const canadaRevenueLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => canadaScale(d.canada_revenue))
                .curve(d3.curveMonotoneX);

            const canadaExpenditureLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => canadaScale(d.canada_expenditure))
                .curve(d3.curveMonotoneX);

            const canadaDebtLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => canadaScale(d.canada_debt))
                .curve(d3.curveMonotoneX);

            // Line generators - USA
            const usaRevenueLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => usaScale(d.usa_revenue))
                .curve(d3.curveMonotoneX);

            const usaExpenditureLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => usaScale(d.usa_expenditure))
                .curve(d3.curveMonotoneX);

            const usaDebtLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => usaScale(d.usa_debt))
                .curve(d3.curveMonotoneX);

            // Add Canada lines (Red color family)
            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", canadaRevenueLine)
                .style("stroke", "#e74c3c")
                .style("stroke-width", "3px");

            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", canadaExpenditureLine)
                .style("stroke", "#c0392b")
                .style("stroke-width", "3px")
                .style("stroke-dasharray", "8,4");

            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", canadaDebtLine)
                .style("stroke", "#a93226")
                .style("stroke-width", "3px")
                .style("stroke-dasharray", "2,3");

            // Add USA lines (Blue color family)
            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", usaRevenueLine)
                .style("stroke", "#3498db")
                .style("stroke-width", "3px");

            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", usaExpenditureLine)
                .style("stroke", "#2980b9")
                .style("stroke-width", "3px")
                .style("stroke-dasharray", "8,4");

            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", usaDebtLine)
                .style("stroke", "#1f4e79")
                .style("stroke-width", "3px")
                .style("stroke-dasharray", "2,3");

            // Add axes
            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale).tickFormat(d3.format("d")));

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(canadaScale).tickFormat(d => `$${d}B CAD`))
                .style("color", "#c0392b");

            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(${width},0)`)
                .call(d3.axisRight(usaScale).tickFormat(d => `$${d}B USD`))
                .style("color", "#2980b9");

            // Add axis labels
            g.append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("y", -90)
                .attr("x", -height/2)
                .style("text-anchor", "middle")
                .style("fill", "#e74c3c")
                .style("font-weight", "bold")
                .text("Canada (Billions CAD)");

            g.append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("y", width + 110)
                .attr("x", -height/2)
                .style("text-anchor", "middle")
                .style("fill", "#3498db")
                .style("font-weight", "bold")
                .text("USA (Billions USD)");

            g.append("text")
                .attr("class", "axis-label")
                .attr("x", width/2)
                .attr("y", height + 60)
                .style("text-anchor", "middle")
                .style("font-weight", "bold")
                .text("Year");

            // Add tooltip
            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Add invisible overlay for mouse events
            g.append("rect")
                .attr("width", width)
                .attr("height", height)
                .style("fill", "none")
                .style("pointer-events", "all")
                .on("mouseover", function() { tooltip.style("opacity", 1); })
                .on("mouseout", function() { tooltip.style("opacity", 0); })
                .on("mousemove", function(event) {
                    const [mouseX] = d3.pointer(event);
                    const year = Math.round(xScale.invert(mouseX));
                    const d = data.find(item => item.year === year);
                    
                    if (d) {
                        tooltip.html(`
                            <strong>${year}</strong><br/>
                            <span style="color: #e74c3c;">Canada:</span><br/>
                            Revenue: $${d.canada_revenue}B CAD<br/>
                            Expenditure: $${d.canada_expenditure}B CAD<br/>
                            Debt: $${d.canada_debt}B CAD<br/>
                            <span style="color: #3498db;">USA:</span><br/>
                            Revenue: $${d.usa_revenue}B USD<br/>
                            Expenditure: $${d.usa_expenditure}B USD<br/>
                            Debt: $${d.usa_debt}B USD
                        `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                    }
                });
        }

        function createRatiosChart() {
            const container = d3.select('#ratios-chart');
            const containerNode = container.node();
            const containerWidth = containerNode.getBoundingClientRect().width;
            
            const margin = {top: 20, right: 140, bottom: 80, left: 140};
            const width = containerWidth - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            // Clear existing chart
            container.selectAll("*").remove();

            const svg = container.append("svg")
                .attr("width", containerWidth)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const xScale = d3.scaleLinear()
                .domain(d3.extent(data, d => d.year))
                .range([0, width]);

            // Ratio scale (0.8 to max ratio + 10%)
            const ratioScale = d3.scaleLinear()
                .domain([0.8, d3.max(data, d => Math.max(d.usa_spending_ratio, d.canada_spending_ratio)) * 1.1])
                .range([height, 0]);

            // Years behind scale
            const yearsScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => Math.max(d.usa_years_behind, d.canada_years_behind)) * 1.1])
                .range([height, 0]);

            // Add grid lines
            g.selectAll(".grid-line")
                .data(ratioScale.ticks(8))
                .enter().append("line")
                .attr("class", "grid-line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", d => ratioScale(d))
                .attr("y2", d => ratioScale(d));

            // Line generators
            const canadaSpendingRatioLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => ratioScale(d.canada_spending_ratio))
                .curve(d3.curveMonotoneX);

            const canadaYearsBehindLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => yearsScale(d.canada_years_behind))
                .curve(d3.curveMonotoneX);

            const usaSpendingRatioLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => ratioScale(d.usa_spending_ratio))
                .curve(d3.curveMonotoneX);

            const usaYearsBehindLine = d3.line()
                .x(d => xScale(d.year))
                .y(d => yearsScale(d.usa_years_behind))
                .curve(d3.curveMonotoneX);

            // Add lines (Canada - Red family, USA - Blue family)
            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", canadaSpendingRatioLine)
                .style("stroke", "#e74c3c")
                .style("stroke-width", "3px");

            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", canadaYearsBehindLine)
                .style("stroke", "#c0392b")
                .style("stroke-width", "3px")
                .style("stroke-dasharray", "8,4");

            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", usaSpendingRatioLine)
                .style("stroke", "#3498db")
                .style("stroke-width", "3px");

            g.append("path")
                .datum(data)
                .attr("class", "chart-line")
                .attr("d", usaYearsBehindLine)
                .style("stroke", "#2980b9")
                .style("stroke-width", "3px")
                .style("stroke-dasharray", "8,4");

            // Add axes
            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale).tickFormat(d3.format("d")));

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(ratioScale).tickFormat(d => `${d.toFixed(1)}x`))
                .style("color", "#e74c3c");

            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(${width},0)`)
                .call(d3.axisRight(yearsScale).tickFormat(d => `${d.toFixed(1)} yrs`))
                .style("color", "#3498db");

            // Add axis labels
            g.append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("y", -50)
                .attr("x", -height/2)
                .style("text-anchor", "middle")
                .style("fill", "#e74c3c")
                .style("font-weight", "bold")
                .text("Spending Ratio (Expenditure/Revenue)");

            g.append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("y", width + 70)
                .attr("x", -height/2)
                .style("text-anchor", "middle")
                .style("fill", "#3498db")
                .style("font-weight", "bold")
                .text("Years Behind in Tax Collection");

            g.append("text")
                .attr("class", "axis-label")
                .attr("x", width/2)
                .attr("y", height + 60)
                .style("text-anchor", "middle")
                .style("font-weight", "bold")
                .text("Year");

            // Add tooltip
            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Add invisible overlay for mouse events
            g.append("rect")
                .attr("width", width)
                .attr("height", height)
                .style("fill", "none")
                .style("pointer-events", "all")
                .on("mouseover", function() { tooltip.style("opacity", 1); })
                .on("mouseout", function() { tooltip.style("opacity", 0); })
                .on("mousemove", function(event) {
                    const [mouseX] = d3.pointer(event);
                    const year = Math.round(xScale.invert(mouseX));
                    const d = data.find(item => item.year === year);
                    
                    if (d) {
                        tooltip.html(`
                            <strong>${year}</strong><br/>
                            Canada Spending Ratio: ${d.canada_spending_ratio.toFixed(2)}x<br/>
                            Canada Years Behind: ${d.canada_years_behind.toFixed(1)} years<br/>
                            USA Spending Ratio: ${d.usa_spending_ratio.toFixed(2)}x<br/>
                            USA Years Behind: ${d.usa_years_behind.toFixed(1)} years
                        `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                    }
                });
        }

        // Initialize
        populateTable();
        createFinancialChart();
        createRatiosChart();

        // Responsive resize
        window.addEventListener('resize', () => {
            setTimeout(() => {
                createFinancialChart();
                createRatiosChart();
            }, 100);
        });
    </script>
</body>
</html>
